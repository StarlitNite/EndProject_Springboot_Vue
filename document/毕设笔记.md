毕设笔记



## 一、遇到的问题

### 1.配置环节出现问题（Maven版本与IDEA版本不适配）

​	问题描述：使用Maven3.8.6与IDEA2021.1时报错。

​	解决办法：修改为Maven3.8.1即可

### 2.运行项目报错

问题描述：配置完成后运行项目报错。图片如下

![image-20221128191252597](C:\Users\26254\AppData\Roaming\Typora\typora-user-images\image-20221128191252597.png)



### 3.数据表内使用xxx_xxx命名；（出现过错误）

### 4.MySQL5.7以上支持Json数据存储但MyBatis不支持，导致报错

![Mybaitsplus不支持Json](E:\IdeaProjects\EndProject\document\图片\Mybaitsplus不支持Json.png)

### 5.趋势数据更新时重复添加

### 6.传参问题

问题内容：2022-12-23 14:45:33.329  WARN 42344 --- [nio-8000-exec-4] .w.s.m.s.DefaultHandlerExceptionResolver : **Resolved [org.springframework.http.converter.HttpMessageNotReadableException: Required request body is missing**: public com.endproject.util.ApiResult<java.lang.Object> com.endproject.controller.UserController.login(com.endproject.Model.dto.LoginInfo)]
出现时间：12.23
出现原因：这个异常是在代码中使用了**@RequestBody**注解的原因，在postman中使用Param传参+@RequestBody接受参数就会出现这个问题
解决方案：1.使用Body中的raw的Json格式传参+@RequestBody
				  2.删去@RequestBody+使用Param传参

### 7.配置问题

问题内容：配置环境时，yml文件driver-class-name 报红
出现原因：不详
解决方案：上一级加入druid:

8.

问题内容：org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userController': Unsatisfied dependency expressed through field 'userService'; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userServiceImpl': Unsatisfied dependency expressed through field 'baseMapper'; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userDao' defined in file [E:\IdeaProjects\car\target\classes\com\car\dao\userDao.class]: Unsatisfied dependency expressed through bean property 'sqlSessionFactory'; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'sqlSessionFactory' defined in class path resource [com/baomidou/mybatisplus/autoconfigure/MybatisPlusAutoConfiguration.class]: Unsatisfied dependency expressed through method 'sqlSessionFactory' parameter 0; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'dataSource' defined in class path resource [com/alibaba/druid/spring/boot/autoconfigure/DruidDataSourceAutoConfigure.class]: Invocation of init method failed; **nested exception is java.sql.SQLException: com.mysql.cj.jdbc.Driver**
出现时间：
出现原因：
解决方案：

### 8：JWT token过期

问题内容：JWT expired at 2023-01-30T05:50:10Z. Current time: 2023-01-30T06:01:03Z, a difference of 653223 milliseconds.  Allowed clock skew: 0 milliseconds.
出现时间：
出现原因：token时间设置过短，解析时报错
解决方案：token时间设置长一些  1000 * 60 * 60

### 9：mybatis查询结果返回为空（NULL）但是查数据库能查到

问题内容：mybatis查询结果返回为空（NULL）但是查数据库能查到
出现时间：
出现原因：数据库表设计按照规范“字段名中各单词使用下划线"_"划分”；如user_id
解决方案：**MybatisPlus默认开启了驼峰命名。**如user_id 则实体类的字段为userId，或将实体类中的user_id改为userid(并且在实体类属性上加@TableField())或将驼峰命名转换关闭。
但是这里有个问题，你关了自动驼峰转换，所有字段都要通过`@TableField()`注解去指定映射关系或者在`mapper.xml`中指定映射关系，这样增加了很多工作量。所以非必要情况下类字段还是不要用`_`去命名字段，省得麻烦。![image-20230202022405108](E:\IdeaProjects\EndProject\document\图片\MybatisPlus驼峰命名转换配置.png)

### 10.yml中Mabits配置出错导致报错

问题内容：项目运行报Invalid bound statement (not found):com.endproject.dao.MenuDao.MenuTree 
出现时间：
出现原因：yml文件中Mabatis配置有误，原配置为classpath:mapper/ */ *Mapper.xml
解决方案：修改为classpath:mapper / *.xml即可

### 11.Mabatis传参问题

问题内容：Mybatis报错: Parameter ‘XXX‘ not found. Available parameters are [arg1, arg0, param1, param2]
出现时间：
出现原因：
解决方案：Service和Dao层传参时记得加入@Param

```
void SaveRoleMenu(@Param("rid") Integer rid,@Param("mid") Integer mid);
```

### 12.PoiExcel导出功能Maven版本冲突

问题内容：引入poi  结果Maven有冲突导致报错
出现时间：
出现原因：
解决方案：修改版本4.0.0→3.14

#### 13.EsayPoi

问题内容：报错
出现时间：
出现原因：
解决方案：

#### 14.Es6语法，${}不生效

问题内容：Es6语法，用单引号  ${}不生效
出现时间：
出现原因：
解决方案：用反引号



## 问题归纳模板

问题内容：
出现时间：
出现原因：
解决方案：



## 二、编程时的思路

### 1.对接阿里疫情接口

接口里含有的数据：

​	"country" //全国数字数据
​			"dataSourceUpdateTime"  //数据更新时间
​			"trend" //疫情趋势
​			"provinceArray"//各个省（市）疫情数据

model->dto  



判断数据  获取到的数据和数据库内数据对比，如果没有变化则不修改，有变化再修改

JSONArray获取



## 三、查资料时学习的知识点

### 一、自定义注释

1.点击File 找到Settings打开
       2.Settings中选择Live Templates
       3.点击最右边的加号+选择2.Template Group…即可添加一个新的模块
       4.点击之后会弹出一个窗口去编辑模块的内容，随便添加一个新的名字，添加完成点击OK
		模板：

### 二、Token拼接

180.07

### 三、MabitsPlus使用LambdaQueryWrapper

多条件查找时，使用.and或者.or .eq是确认内容
获取查找的信息时，使用Service提供的.getList或.getMap等

### 四、Mabits中#和$的区别

#号相当于JDBC中的“？”，相当于向PreparedStatement中的预处理语句设置参数，而PreparedStatement中的SQL是预编译的，SQL在设置参数是遇到特殊字符会自动进行转义，#占位符可以防止SQL注入
       $相当于直接把参数拼接到了原始SQL中，Mabits不会对其进行任何处理，容易出现注入风险
		两者的区别在于：$是动态参数，#是占位符，动态参数无法防止SQL注入
尽可能使用#占位符。$适合用于动态传递表名，动态设置排序字段等。

```java
例：使用 ${} 时，就是简单的字符串替换，而#{}是设置PreparedStatement 参数占位符，就像使用？，比如：select * from user where id = ？

如果说要想动态查询指定列数据时，如果使用#{}，需要这样：
@Select("select * from user where id = #{id}")
User findById(@Param("id") long id);

@Select("select * from user where name = #{name}")
User findByName(@Param("name") String name);

@Select("select * from user where email = #{email}")
User findByEmail(@Param("email") String email);

如果使用${}，则只需要就这样：
@Select("select * from user where ${column} = #{value}")
User findByColumn(@Param("column") String column, @Param("value") String value);​
```

例：使用 ${} 时，就是简单的字符串替换，而#{}是设置PreparedStatement 参数占位符，就像使用？，比如：select * from user where id = ？

如果说要想动态查询指定列数据时，如果使用#{}，需要这样：
@Select("select * from user where id = #{id}")
User findById(@Param("id") long id);

@Select("select * from user where name = #{name}")
User findByName(@Param("name") String name);

@Select("select * from user where email = #{email}")
User findByEmail(@Param("email") String email);

如果使用${}，则只需要就这样：
@Select("select * from user where ${column} = #{value}")
User findByColumn(@Param("column") String column, @Param("value") String value);​

#### 五.Vue3中 渲染函数

ref：定义数据的    简单类型[数组等]，定义复杂类型需要多一步    参数.value

reactive：定义数据的 复杂类型（对象），不能定义简单类型

## 四、已完成的任务

1.Swagger3整合完成

2.阿里疫情接口对接+入库完成

3.后端登录调试完毕

4.根据权限显示菜单完成

5.分配权限，权限获取，增删改查完成

6.数据导入导出完成

7.审批教师端结束  学生端用

8.使用触发器，改变学生填报状态

9.user给一个填报状态 每日重置  学生提交后状态变为已填报（每日更新填报状态）

10.学生请假

## 五、目前想到待完成的任务

后端拦截器   密码加密

前端JWT权限验证  验证是哪个身份登录的 （完成）

超级管理员菜单增删改查（完成）

按照pid for循环把title存入K-pid v-title（list）（完成）

学生可以批量删除可以单个删除 通过Excel添加

表单

修改用户信息时 管理员可修改下拉框选择院系、专业、辅导员、班级；学生学生可自行修改密码，其余不可动。辅导员完全不可动（只读）。

添加用户信息时 管理员添加用户名、前端默认一个密码无法修改、根据id选择院系、专业等。

聊天室也是消息推送  WebSocket  审批

每日上报状态  提交变为1  未提交为0  教师端查看提交

学生端    请假记录   请假历史   请假 填写  查看详情  有节点状态 

教师端 审核  菜单里加审核选项   

区分请假与离返校 

请假还得销假，超过时间变成超时

导员显示对应班级人员的请假记录  查询教师ID为_的学生ID为__的请假表中的内容（完成）

加入nstu  1–教职工 0–学生



推送，定时任务



#### 部分未完成的

stuli的分页和导入表格，以及updatedialog的修改

mgrvac.vue 教师审核页面  同意 驳回  两个数值       学生请假弹窗

离校返校页面（不是请假）

教师查看自己id对应的学生：） wcnmm



通知/ 饼状图  

点击填报按钮，向其发送消息，后面跟着带填报页面的链接 ：今日未填报__点击填报___这样



登录时将curUserId—curUserName 赋值  
getSessionListNot()
sessionListAlready()
startSession()

user.id = userType.snum

在我这边登录的时候直接给一个Session  chat时验证+获取可建立会话列表+获取已存在会话列表+创建会话+开始会话+结束会话

sessionId 当前会话id

curUserId 当前对话本人id  fromUserId 当前对话对方id

登录时已经存储了，来到chat页面从cookie获取一遍姓名和学号即可



23 给 21 创建会话 （那么sessionId是自增生成的，后期获取时直接传递即可）

 向后端发送 自身id，对方id，对方姓名 创建session

还需要以对方id+自身id+自身姓名 创建session 
